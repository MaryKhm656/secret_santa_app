{% extends "base.html" %}

{% block title %}–ú–æ–∏ –∑–∞—è–≤–∫–∏ - Secret Santa{% endblock %}

{% block content %}
<div class="requests-container">
    <div class="requests-header">
        <h1>üì® –ú–æ–∏ –∑–∞—è–≤–∫–∏</h1>
        <p>–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –∏–≥—Ä—ã</p>
    </div>

    <div class="content-container">
        {% if pending_requests %}
        <section class="content-sections">
            <h2>‚è≥ –û–∂–∏–¥–∞—é—Ç –º–æ–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è</h2>
            <p class="section-description">–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –≤–∞—à–∏ –∏–≥—Ä—ã</p>

            <div class="content-sections">
                {% for request in pending_requests %}
                <div class="content-section">
                    <div class="request-header">
                        <h3>{{ request.game.title }}</h3>
                        <span class="request-badge pending">–û–∂–∏–¥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è</span>
                    </div>

                    <div class="request-details">
                        <div class="request-user">
                            <span class="user-avatar">
                                {{ request.user.username[0]|upper if request.user.username else request.user.email[0]|upper }}
                            </span>
                            <span class="user-info">
                                <strong>{{ request.user.username or request.user.email }}</strong>
                                <span>—Ö–æ—á–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≤–∞—à–µ–π –∏–≥—Ä–µ</span>
                            </span>
                        </div>

                        <div class="request-meta">
                            <span class="meta-item">üìÖ {{ request.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                        </div>
                    </div>

                    <div class="request-actions">
                        <form action="/requests/{{ request.id }}/approve" method="POST" class="inline-form">
                            <button type="submit" class="btn btn-success">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>
                        </form>
                        <form action="/requests/{{ request.id }}/reject" method="POST" class="inline-form">
                            <button type="submit" class="btn btn-danger"
                                    onclick="return confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É –æ—Ç {{ request.user.username or request.user.email }}?')">
                                ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <section class="content-sections">
            <h2>üì§ –ú–æ–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏</h2>
            <p class="section-description">–ó–∞—è–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –∏–≥—Ä—ã</p>

            {% if sent_requests %}
            <div class="content-sections">
                {% for request in sent_requests %}
                <div class="content-section {{ 'approved-card' if request.status == 'approved' else 'rejected-card' if request.status == 'rejected' else 'sent-card' }}">
                    <div class="request-header">
                        <h3>{{ request.game.title }}</h3>
                        <span class="request-badge
                            {% if request.status == 'approved' %}approved
                            {% elif request.status == 'rejected' %}rejected
                            {% else %}pending{% endif %}">
                            {% if request.status == 'approved' %}‚úÖ –û–¥–æ–±—Ä–µ–Ω–∞
                            {% elif request.status == 'rejected' %}‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–∞
                            {% else %}‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏{% endif %}
                        </span>
                    </div>

                    <div class="request-details">
                        <div class="request-info">
                            <span>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä: <strong>{{ request.game.organizer.username or request.game.organizer.email }}</strong></span>
                            {% if request.game.description %}
                            <span class="game-description">{{ request.game.description }}</span>
                            {% endif %}
                        </div>

                        <div class="request-meta">
                            <span class="meta-item">üìÖ {{ request.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                            {% if request.status != 'pending' %}
                            <span class="meta-item">
                                {% if request.status == 'approved' %}üéâ –í—ã –≤ –∏–≥—Ä–µ!
                                {% elif request.status == 'rejected' %}üòî –í–∞–º –æ—Ç–∫–∞–∑–∞–ª–∏
                                {% endif %}
                            </span>
                            {% endif %}
                        </div>
                    </div>

                    {% if request.status == 'approved' %}
                    <div class="request-success">
                        <a href="/game/{{ request.game.id }}" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∏–≥—Ä–µ</a>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-requests">
                <div class="empty-emoji">üì≠</div>
                <h3>–ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                <p>–ù–∞–π–¥–∏—Ç–µ –∏–≥—Ä—É –ø–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É –∫–ª—é—á—É, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∑–∞—è–≤–∫—É!</p>
                <a href="/games" class="btn btn-primary">–ù–∞–π—Ç–∏ –∏–≥—Ä—É</a>
            </div>
            {% endif %}
        </section>
    </div>
</div>
{% endblock %}